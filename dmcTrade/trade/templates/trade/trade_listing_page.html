{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}trade-page{% endblock %}

{% block header %}
    {{ page.title }}
{% endblock %}

{% block content %}
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script>var cardPrice = {{ page.card_price }};</script>

    {% for block in page.body %}
        {{ block }}
    {% endfor %}

    <section>
        <h2>Order form</h2>
        <p>Select the cards from above, then fill in your details</p>
        <form id="order-form" action="." method="POST">
            {% csrf_token %}

            <div class="field-wrapper">
                {{ form.name.errors }} {{ form.name.label_tag }} {{ form.name }}
            </div>
            <div class="field-wrapper">
                {{ form.email.errors }} {{ form.email.label_tag }} {{ form.email }}
            </div>

            {{ form.order.as_hidden }}

            {% verbatim %}
                <div id="order-list">
                    <table v-if="totalAmount > 0">
                        <thead>
                            <tr>
                                <th>Item code</th>
                                <th>Item name</th>
                                <th>Quantity</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, code) in order" v-if="item.amount !== '0'">
                                <td class="item-code">{{ code }}</td>
                                <td class="item-name">{{ item.name }}</td>
                                <td>{{ item.amount }}</td>
                                <td>£{{ item.price }}</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>Total</th>
                                <th></th>
                                <th>{{ totalAmount }}</th>
                                <th>£{{ totalPrice }}</th>
                            </tr>
                        </tfoot>
                    </table>
                    <div v-else>Select items from above.</div>

                    <div><button type="submit" :disabled="totalAmount === 0">Submit order</div>
                </div>
            {% endverbatim %}
        </form>
    </section>
{% endblock %}
